generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model Empresa {
  codEmp       Int      @id @default(autoincrement())
  nomeFantasia String   @map("Empresa")
  razaoSocial  String   @map("Razao")
  cnpj         String?  @map("CGC")
  inscEstadual String?  @map("IE")
  im           String?  @map("IM")
  cep          String?
  endereco     String?
  bairro       String?
  cidade       String?
  estado       String?
  telefone     String?  @map("Tel")
  telefoneSec  String?  @map("Tel2")
  cabecalho    String?
  observacao   String?
  ativo        Boolean  @default(true)
  servicos     Servico[]

  @@map("EMPRESA")
}

model Usuario {
  codUsu        Int      @id @default(autoincrement()) @map("CodUsu")

  login         String   @db.VarChar(20) @unique @map("Usuario")
  senha         String   @db.VarChar(4)  @map("Senha")

  email         String?  @db.VarChar(40) @map("EMail")
  caminhoFoto   String?  @db.VarChar(100) @map("CaminhoFoto")

  op8           String   @db.VarChar(1) @default("") @map("Op8")
  op91          String   @db.VarChar(1) @default("") @map("Op91")
  op28          String   @db.VarChar(1) @default("") @map("Op28")

  op34          String   @db.VarChar(1) @default("0") @map("Op34")
  op52          String   @db.VarChar(1) @default("0") @map("Op52")

  estoqueLocal  String   @db.VarChar(1) @default("0") @map("EstoqueLocal")
  inativo       String   @db.VarChar(1) @default("") @map("Inativo")

  dataCad       DateTime @default(now()) @map("DataCad")
  horaCad       String   @db.VarChar(5)  @default("00:00") @map("HoraCad")

  @@map("USUARIO")
  servicos Servico[] @relation("UltimaModificacao")
  servicoHistoricos ServicoHistorico[]
}


model Servico {
  pedido            Int                @id @default(autoincrement())
  data              DateTime           @map("Data")
  horaProposta      String?
  contato           String?            @map("Contato")
  tellResp          String?            @map("TellResp")
  responsavel       String?            @map("Responsavel")
  solicitacao       String             @map("Reclamado")
  status            String             @default("Solicitado")
  /// Canal de Origem do ticket: WHATSAPP | EMAIL | WEB
  canalOrigem       String             @default("WEB") @map("CanalOrigem")
  observacao        String?
  codEmp            Int?
  empresa           Empresa?           @relation(fields: [codEmp], references: [codEmp])
  codUsuUltimoEdit  Int?               @map("CodUsu")
  usuario           Usuario?           @relation("UltimaModificacao", fields: [codUsuUltimoEdit], references: [codUsu])
  historico         ServicoHistorico[]

  @@map("SERVICO")
}

model ServicoHistorico {
  id              Int       @id @default(autoincrement())
  pedidoId        Int       @map("Pedido")
  servico         Servico   @relation(fields: [pedidoId], references: [pedido], onDelete: NoAction, onUpdate: NoAction)
  data            DateTime
  statusAnterior  String?
  statusNovo      String?
  historico       String    @map("Historico")
  codUsu          Int?
  autor           Usuario?  @relation(fields: [codUsu], references: [codUsu], onDelete: SetNull, onUpdate: NoAction)

  @@map("SERVICO_HIS")
}
